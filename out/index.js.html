<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>let textEncoding = require('text-encoding');

module.exports = {
    /**
     * Converts an array of bytes to text
     * @param {array} An array of utf-8 bytes
     * @returns {string} A string
     */
    arrayToStr: function (array) {
        let rr = new Uint8Array(array);
        var v = new textEncoding.TextDecoder();
        return v.decode(rr);
    },

    /**
     * Converts a string to a utf-8 array
     * @param {str} A string
     * @returns {Array} Returns an array of numbers
     */
    strToArray: function (str) {
        var result = [];
        for (var i = 0; i &lt; str.length; i++) {
            var code = str.charCodeAt(i);
            result.push(code);
        }
        return result;
    },

    /**
     * Decodes a string or array of DGData
     * Arrays work best, as strings loose data due to utf-8 / unicode
     * @param {data} This is the data to be decoded
     * @returns {string} This is the result of the data
     */
    decode: function (data) {
        if (typeof data == 'string') data = module.exports.strToArray(data);

        for (var i = 14; i &lt; data.length; i++) {
            data[i] = data[i] - 21;
            data[i] = data[i] - ((i - 14) % 6);
        }
        return module.exports.arrayToStr(data).substring(14);
    },

    /**
     * Encodes a string of data
     * @param {data} Data to be encoded
     * @returns {array} An array of bytes
     */
    encode: function (data) {
        var loc3 = 0;
        if (typeof data !== 'string') {
            data = module.exports.arrayToStr(data);
        }

        var loc2 = module.exports.strToArray(
            'DGDATA' + module.exports.hash(data)
        );

        for (var i = 0; i &lt; data.length; i++) {
            loc3 = data.charCodeAt(i) + 21 + (i % 6);
            loc2.push(loc3 % 256);
        }

        return loc2;
    },
    /**
     * Get the daily challenge given the number
     * @param {number} daily challenge number
     * @returns {Promise} daily challenge object
     */
    getDaily: function (number) {
        let promise = new Promise((resolve, reject) => {
            let url =
                'https://static-api.nkstatic.com/appdocs/11/dailyChallenges/' +
                number;
            // this website is in bytes, but because you are viewing it in a browser you see weird text. That is what { encoding : null } is for
            request(url, { encoding: null }, (err, res, body) => {
                if (err) {
                    reject('req');
                }

                let g = dgdata.decode(body).toString('utf-8');
                let json = JSON.parse(g);

                resolve(json);
            });
        });
        return promise;
    },
    /**
     * Gets an odyssey given the date
     * @param {string} dateStr
     * @returns {Promise} odyssey object
     */
    getOdy: function (dateStr) {},
    /**
     * Encodes a number - You really shouldn't have to deal with this
     * @param {number} The number to be encoded
     * @returns {number} The result
     */
    secondHash: function (number) {
        var loc2 = new Uint32Array(1);
        loc2[0] = number;
        for (var i = 0; i &lt; 8; i++) {
            if (loc2 &amp; 1) {
                loc2[0] = loc2[0] >> 1;
                loc2[0] = loc2[0] ^ 3988292384;
            } else {
                loc2[0] = loc2[0] >> 1;
            }
        }
        return loc2;
    },

    /**
     * Hashes some data - You really shouldn't have to deal with this
     * unless you want to manually verify the program
     * @param {data} Some data - it's a string
     * @returns {array} An array of bytes
     */
    hash: function (data) {
        var loc6 = 0;
        var loc2 = 0;
        var loc3 = 0;
        var loc7 = new Uint32Array(1);

        for (var i = 0; i &lt; data.length; i++) {
            loc2 = data.charCodeAt(loc6);
            loc3 = (loc7[0] ^ loc2) &amp; 255;
            loc7[0] =
                ((loc7[0] >> 8) &amp; 16777215) ^ module.exports.secondHash(loc3);
        }
        if (loc7[0] &lt; 0) {
            loc7[0] = 4294967295 + loc7[0] + 1;
        }
        var loc4 = loc7[0].toString(16);
        while (loc4.length &lt; 8) {
            loc4 = '0' + loc4;
        }
        return loc4;
    },
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Fri Dec 04 2020 21:50:12 GMT+0800 (Singapore Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
